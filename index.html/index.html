<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Oâ€˜zbekiston Media Portal</title>
<style>
  /* Reset */
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #121212;
    color: #fff;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
  }
  header {
    background-color: #e50914;
    padding: 20px;
    text-align: center;
    font-size: 24px;
    font-weight: 700;
    user-select: none;
    letter-spacing: 1.5px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.3);
  }

  /* Container */
  .app-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    max-width: 1200px;
    margin: 20px auto;
    background: #181818;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 20px rgba(0,0,0,0.7);
  }

  /* Player on top */
  .player {
    background: #000;
    border-radius: 10px 10px 0 0;
    position: relative;
    padding: 15px;
    box-shadow: inset 0 0 50px #e50914;
  }
  video {
    width: 100%;
    max-height: 60vh;
    border-radius: 10px;
    background: #000;
    outline: none;
    box-shadow: 0 0 20px #e50914;
  }
  .video-title {
    margin-top: 12px;
    font-size: 20px;
    font-weight: 700;
    text-align: center;
    color: #e50914;
    text-shadow: 0 0 8px #ff0000aa;
    user-select: none;
  }

  /* Volume button */
  .volume-btn {
    position: absolute;
    bottom: 25px;
    right: 25px;
    background: #e50914;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 20px;
    box-shadow: 0 0 10px #e50914;
    user-select: none;
  }

  /* Sidebar below player */
  .sidebar {
    background: #222;
    padding: 15px;
    border-top: 3px solid #e50914;
    overflow-y: auto;
    max-height: 35vh;
    border-radius: 0 0 10px 10px;
  }

  /* Search input */
  .search-box {
    margin-bottom: 10px;
  }
  .search-box input {
    width: 100%;
    padding: 10px 15px;
    border-radius: 6px;
    border: none;
    outline: none;
    font-size: 16px;
    background: #121212;
    color: #eee;
    box-shadow: inset 1px 1px 5px #000;
    transition: background 0.3s;
  }
  .search-box input::placeholder {
    color: #777;
  }
  .search-box input:focus {
    background: #222;
    box-shadow: inset 1px 1px 8px #e50914;
  }

  /* Category tabs */
  .category-tabs {
    display: flex;
    margin-bottom: 10px;
    gap: 15px;
  }
  .category-tabs button {
    flex: 1;
    padding: 12px;
    background: #333;
    color: #eee;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s, color 0.3s;
    user-select: none;
  }
  .category-tabs button.active,
  .category-tabs button:hover {
    background: #e50914;
    color: white;
    box-shadow: 0 0 10px #e50914;
  }

  /* List of items */
  .list {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
    max-height: calc(35vh - 120px);
    overflow-y: auto;
  }
  @media(max-width: 900px) {
    .list {
      grid-template-columns: 1fr 1fr;
    }
  }
  @media(max-width: 600px) {
    .list {
      grid-template-columns: 1fr;
    }
  }

  .list-item {
    background: #333;
    padding: 12px 15px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.25s, transform 0.2s;
    display: flex;
    align-items: center;
    font-weight: 600;
    font-size: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    user-select: none;
  }
  .list-item:hover {
    background: #e50914;
    color: white;
    transform: scale(1.05);
    box-shadow: 0 5px 15px #e50914;
  }
  .list-item.active {
    background: #b20e17;
    color: white;
    box-shadow: 0 5px 15px #b20e17;
  }

  /* Scrollbar styling */
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-track {
    background: #181818;
  }
  ::-webkit-scrollbar-thumb {
    background-color: #e50914;
    border-radius: 4px;
  }
</style>
</head>
<body>

<header>ðŸ“º Oâ€˜zbekiston Media Portal</header>

<div class="app-container">
  <div class="player">
    <video id="video" controls autoplay playsinline></video>
    <button class="volume-btn" id="volumeBtn" title="Ovoz o'chirish/yoqish">ðŸ”Š</button>
    <div class="video-title" id="videoTitle">Tanlang kanal yoki film</div>
  </div>

  <div class="sidebar">
    <div class="category-tabs">
      <button id="btnTv" class="active" onclick="selectCategory('tv', this)">Telekanallar</button>
      <button id="btnMovies" onclick="selectCategory('movies', this)">Kinolar/Multfilmlar</button>
    </div>

    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Qidirish..." oninput="filterList()" />
    </div>

    <div class="list" id="list"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  const categories = {
    tv: [],
    movies: [
      {name: "Big Buck Bunny", url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"},
      {name: "Sintel", url: "https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8"},
      {name: "Tears of Steel", url: "https://test-streams.mux.dev/tears-of-steel/master.m3u8"},
      // Qo'shimcha kinolar/multfilmlar shu yerga qo'shilsin
    ]
  };

  const video = document.getElementById('video');
  const list = document.getElementById('list');
  const videoTitle = document.getElementById('videoTitle');
  const searchInput = document.getElementById('searchInput');
  const volumeBtn = document.getElementById('volumeBtn');

  let hls;
  let currentCategory = 'tv';
  let displayedItems = [];
  let activeIndex = -1;

  async function fetchChannels() {
    try {
      const res = await fetch('https://iptv-org.github.io/iptv/countries/uz.m3u');
      const txt = await res.text();
      const lines = txt.split(/\r?\n/);
      for (let i = 0; i < lines.length; i++) {
        if (lines[i].startsWith('#EXTINF')) {
          const name = lines[i].split(',')[1] || 'NomaÊ¼lum';
          const url = lines[i+1];
          if (url && (url.includes('.m3u8') || url.startsWith('http'))) {
            categories.tv.push({name, url});
          }
        }
      }
    } catch (e) {
      console.error('Playlist yuklanmadi:', e);
      alert('Telekanallar roâ€˜yxatini yuklab boâ€˜lmadi!');
    }
  }

  function clearActive() {
    document.querySelectorAll('.list-item').forEach(el => el.classList.remove('active'));
  }

  function renderList(items) {
    list.innerHTML = '';
    items.forEach((item, idx) => {
      const el = document.createElement('div');
      el.className = 'list-item';
      el.textContent = item.name;
      el.onclick = () => {
        playStream(item);
        setActive(idx);
      };
      list.appendChild(el);
    });
    displayedItems = items;
    if(items.length > 0) {
      setActive(0);
      playStream(items[0]);
    } else {
      video.pause();
      video.src = "";
      videoTitle.textContent = "Natija topilmadi";
    }
  }

  function setActive(idx) {
    clearActive();
    const items = document.querySelectorAll('.list-item');
    if(idx >= 0 && idx < items.length) {
      items[idx].classList.add('active');
      videoTitle.textContent = displayedItems[idx].name;
      activeIndex = idx;
    }
  }

  function selectCategory(cat, btn) {
    currentCategory = cat;
    document.querySelectorAll('.category-tabs button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    searchInput.value = "";
    renderList(categories[cat]);
  }

  function playStream(item) {
    if(hls) {
      hls.destroy();
      hls = null;
    }
    if(item.url.includes('.m3u8') && Hls.isSupported()) {
      hls = new Hls();
      hls.loadSource(item.url);
      hls.attachMedia(video);
    } else {
      video.src = item.url;
    }
    video.play().catch(() => {});
    videoTitle.textContent = item.name;
  }

  // Ovozni yoqish/o'chirish tugmasi
  volumeBtn.addEventListener('click', () => {
    video.muted = !video.muted;
    volumeBtn.textContent = video.muted ? 'ðŸ”‡' : 'ðŸ”Š';
  });

  // Dastlab kanallarni yuklab, telekanallar roâ€˜yxatini koâ€˜rsatamiz
  fetchChannels().then(() => {
    renderList(categories.tv);
  });
</script>

</body>
</html>
